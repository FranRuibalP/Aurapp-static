(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[63],{5499:()=>{},19674:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return a(56755)}])},49841:(e,t,a)=>{"use strict";a(5640),a(5499)},56755:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>f});var s=a(5640);a(49841);var r=a(50148),l=a(43054),o=a(59581),i=a(76460),n=a(73143),c=a(59846),d=a(50755),u=a(32941),m=a(84690),x=a(12300),h=a(15967),p=a(33539),g=a(43297),b=a(66064);function f(){var e,t;let[a,f]=(0,r.useState)(null),[v,j]=(0,r.useState)([]),[N,w]=(0,r.useState)([]),[y,k]=(0,r.useState)(0),[C,_]=(0,r.useState)(0),[z,E]=(0,r.useState)(!0),[I,P]=(0,r.useState)(!0),[S,A]=(0,r.useState)(!1),[L,T]=(0,r.useState)({username:"",email:"",password:""}),[U,B]=(0,r.useState)(null),[R,D]=(0,r.useState)("dedicated"),[O,X]=(0,r.useState)(!1),[K,F]=(0,r.useState)({message:"",type:""}),H=(0,r.useRef)(),G=JSON.parse(localStorage.getItem("user"));(0,r.useEffect)(()=>{G&&(l.A.get("".concat(b.env.NEXT_PUBLIC_URL_BACKEND,"users/").concat(G._id)).then(e=>{f(e.data),T({username:e.data.username,email:e.data.email,password:""})}),W("dedicated"),W("authored"))},[]);let W=async e=>{let t="dedicated"===e?y:C,a=(await l.A.get("".concat(b.env.NEXT_PUBLIC_URL_BACKEND,"posts/user/").concat(G._id))).data.filter(t=>{var a,s;return"dedicated"===e?(null==(a=t.dedicatedTo)?void 0:a._id)===G._id:(null==(s=t.author)?void 0:s._id)===G._id}).slice(t,t+10);"dedicated"===e?(j(e=>[...e,...a]),k(e=>e+10),a.length<10&&E(!1)):(w(e=>[...e,...a]),_(e=>e+10),a.length<10&&P(!1))},q=e=>{H.current&&H.current.disconnect(),H.current=new IntersectionObserver(e=>{e[0].isIntersecting&&("dedicated"===R&&z&&W("dedicated"),"authored"===R&&I&&W("authored"))}),e&&H.current.observe(e)},J=async e=>{let t=new FormData;t.append("file",e),t.append("upload_preset","userImages");try{let{secure_url:e,public_id:a}=(await l.A.post("https://api.cloudinary.com/v1_1/".concat(b.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,"/image/upload"),t,{headers:{"Content-Type":"multipart/form-data"}})).data;return[e,a]}catch(e){return console.error("Error al subir imagen:",e),null}},M=async()=>{X(!0);try{let e=a.profileImage,t=a.imagePublicId,s=a.imagePublicId;if(U){let a=await J(U);if(!a)throw Error("Fall\xf3 la subida de imagen");e=a[0],t=a[1]}let r={username:L.username,email:L.email,password:L.password,newImage:{profileImage:e,imagePublicId:t},oldImagePublicId:s};await l.A.put("".concat(b.env.NEXT_PUBLIC_URL_BACKEND,"users/").concat(a._id,"/data"),r);let o=await l.A.get("".concat(b.env.NEXT_PUBLIC_URL_BACKEND,"users/").concat(a._id));f(o.data),A(!1),F({message:"Perfil actualizado con \xe9xito",type:"success"})}catch(e){console.error("Error al guardar los cambios:",e),F({message:"Hubo un error al guardar",type:"error"})}finally{X(!1),setTimeout(()=>F({message:"",type:""}),3e3)}},Y=(t=null==a?void 0:a.aura)<500?"rose":t<1500?"indigo":t<2e3?"emerald":"yellow",$=(null==a||null==(e=a.auraHistory)?void 0:e.map(e=>({date:new Date(e.date).toLocaleDateString(),aura:e.value})))||[];return a?(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-tr from-neutral-950 via-".concat(Y,"-950 to-").concat(Y,"-600 text-zinc-50"),children:[(0,s.jsx)(o.A,{}),(0,s.jsx)("div",{className:"hidden  bg-rose-600 hover:bg-rose-700 border-rose-600 to-rose-600 to-rose-950 bg-indigo-600 hover:bg-indigo-700 border-indigo-600 to-indigo-600 to-indigo-950 bg-emerald-600 hover:bg-emerald-700 border-emerald-600 to-emerald-600 to-emerald-950  bg-yellow-600 hover:bg-yellow-700 border-yellow-600 to-yellow-600 to-yellow-950"}),(0,s.jsxs)("div",{className:"pt-24 px-4 flex flex-col items-center gap-4",children:[(0,s.jsx)("div",{className:"relative w-32 h-32",children:(0,s.jsx)("img",{src:a.profileImage,alt:"Perfil",className:"rounded-full w-full h-full object-cover border-4 shadow border-white"})}),(0,s.jsx)("h1",{className:"text-3xl font-bold",children:a.username}),(0,s.jsxs)("div",{className:"text-lg font-semibold",children:["Aura: ",a.aura]}),(0,s.jsx)("button",{onClick:()=>A(!0),className:"cursor-pointer bg-".concat(Y,"-600 hover:bg-").concat(Y,"-700 text-white px-4 py-2 rounded-lg"),children:"Editar perfil"}),(0,s.jsxs)("div",{className:"w-full max-w-2xl mt-6",children:[(0,s.jsx)("div",{className:"flex border-b mb-4",children:["dedicated","authored","aura"].map(e=>(0,s.jsx)("button",{onClick:()=>D(e),className:"cursor-pointer flex-1 py-2 ".concat(R===e?"border-b-2 border-".concat(Y,"-600 font-bold"):"text-zinc-400"),children:"dedicated"===e?"Posts dedicados":"authored"===e?"Posts creados":"Historial de Aura"},e))}),"dedicated"===R&&v.map((e,t)=>(0,s.jsx)("div",{className:"mb-6",ref:t===v.length-1?q:null,children:(0,s.jsx)(i.A,{post:e})},e._id)),"authored"===R&&N.map((e,t)=>(0,s.jsx)("div",{className:"mb-6",ref:t===N.length-1?q:null,children:(0,s.jsx)(i.A,{post:e})},e._id)),"aura"===R&&(0,s.jsx)(u.u,{width:"100%",height:300,children:(0,s.jsxs)(m.b,{data:$,children:[(0,s.jsx)(x.W,{dataKey:"date",stroke:"#8884d8"}),(0,s.jsx)(h.h,{stroke:"#8884d8"}),(0,s.jsx)(p.m,{}),(0,s.jsx)(g.N,{type:"monotone",dataKey:"aura",stroke:"#8884d8",strokeWidth:2})]})})]})]}),(0,s.jsx)(c.e,{show:S,as:r.Fragment,children:(0,s.jsx)(d.lG,{as:"div",className:"fixed inset-0 z-50 overflow-y-auto",onClose:()=>A(!1),children:(0,s.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-black/30 p-4",children:(0,s.jsx)(c.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,s.jsxs)(d.lG.Panel,{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md transform transition-all",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Editar Perfil"}),(0,s.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,s.jsxs)("div",{className:"relative w-24 h-24 mx-auto",children:[(0,s.jsx)("img",{src:U?URL.createObjectURL(U):a.profileImage,className:"rounded-full w-full h-full object-cover border"}),(0,s.jsxs)("label",{className:"absolute bottom-0 right-0 p-1 bg-white/80 rounded-full cursor-pointer",children:[(0,s.jsx)(n.SG1,{className:"text-gray-800"}),(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:e=>B(e.target.files[0]),className:"hidden"})]})]}),(0,s.jsx)("input",{type:"text",placeholder:"Nombre de usuario",value:L.username,onChange:e=>T({...L,username:e.target.value}),className:"border p-2 rounded"}),(0,s.jsx)("input",{type:"email",placeholder:"Correo",value:L.email,onChange:e=>T({...L,email:e.target.value}),className:"border p-2 rounded"}),(0,s.jsx)("input",{type:"password",placeholder:"Nueva contrase\xf1a",value:L.password,onChange:e=>T({...L,password:e.target.value}),className:"border p-2 rounded"}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,s.jsx)("button",{onClick:()=>A(!1),className:"cursor-pointer px-4 py-2 bg-gray-300 dark:bg-gray-700 hover:bg-gray-600 rounded",children:"Cancelar"}),(0,s.jsx)("button",{onClick:M,disabled:O,className:"cursor-pointer px-4 py-2 flex items-center justify-center gap-2 bg-".concat(Y,"-600 hover:bg-").concat(Y,"-700 text-white rounded disabled:opacity-60"),children:O?(0,s.jsxs)("svg",{className:"animate-spin h-5 w-5 text-white",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]}):"Guardar"})]}),K.message&&(0,s.jsx)("div",{className:"mt-4 px-4 py-2 text-sm rounded text-center ".concat("success"===K.type?"bg-green-600 text-white":"bg-red-600 text-white"),children:K.message})]})]})})})})})]}):null}},59581:(e,t,a)=>{"use strict";a.d(t,{A:()=>m});var s=a(5640),r=a(86826),l=a.n(r),o=a(87060),i=a(50148),n=a(94556);function c(e){let{isOpen:t,toggle:a}=e;return(0,s.jsxs)("button",{onClick:a,className:"cursor-pointer relative z-50 w-5 h-5 flex flex-col justify-between items-center",children:[(0,s.jsx)(n.P.span,{animate:{rotate:45*!!t,y:8*!!t},className:"w-full h-1 bg-white rounded origin-center",transition:{duration:.3}}),(0,s.jsx)(n.P.span,{animate:{opacity:+!t},className:"w-full h-1 bg-white rounded",transition:{duration:.3}}),(0,s.jsx)(n.P.span,{animate:{rotate:t?-45:0,y:t?-8:0},className:"w-full h-1 bg-white rounded origin-center",transition:{duration:.3}})]})}var d=a(70829);function u(e){let{isOpen:t,children:a}=e;return(0,s.jsx)(d.N,{children:t&&(0,s.jsx)(n.P.div,{initial:{y:-100,opacity:0},animate:{y:0,opacity:1},exit:{y:-100,opacity:0},transition:{duration:.3},className:"absolute top-0 left-0 w-full bg-black bg-opacity-90 flex flex-col items-center py-6 z-40",children:a})})}function m(e){let{aura:t}=e,[a,r]=(0,i.useState)(!1),n=(0,o.useRouter)(),d=()=>r(!a),m=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),n.replace("/")};return(0,s.jsxs)("nav",{className:"fixed top-0 left-0 w-full px-4 py-2 flex justify-between items-center bg-black z-50",children:[(0,s.jsx)("h1",{className:"text-white font-bold text-xl",children:"Aurapp"}),(0,s.jsx)(c,{isOpen:a,toggle:d}),(0,s.jsxs)(u,{isOpen:a,children:[(0,s.jsx)("a",{href:"/home/#inicio",onClick:d,className:"text-white text-lg my-2",children:"Inicio"}),(0,s.jsx)("a",{href:"/home/#ranking",onClick:d,className:"text-white text-lg my-2",children:"Ranking"}),(0,s.jsx)(l(),{href:{pathname:"/posts",query:{aura:t}},passHref:!0,className:"text-white text-lg my-2",onClick:d,children:"Posts"}),(0,s.jsx)(l(),{href:{pathname:"/profile",query:{aura:t}},passHref:!0,className:"text-white text-lg my-2",onClick:d,children:"Perfil"}),(0,s.jsx)("button",{onClick:()=>{d(),m()},className:"cursor-pointer text-white text-lg my-2 text-left",children:"Cerrar sesi\xf3n"})]})]})}},76460:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var s=a(5640),r=a(50148),l=a(94556),o=a(73143),i=a(43054);a(49841);var n=a(66064);function c(e){let{post:t}=e,[a,c]=(0,r.useState)({upvote:t.tickCount,downvote:t.crossCount,selected:null}),[d,u]=(0,r.useState)(""),[m,x]=(0,r.useState)(!1),h=t._id;(0,r.useEffect)(()=>{let e=JSON.parse(localStorage.getItem("user"));u((null==e?void 0:e._id)||"")},[]),(0,r.useEffect)(()=>{let e=t.upvotedBy.map(e=>e.toString()).includes(d),a=t.downvotedBy.map(e=>e.toString()).includes(d);c({upvote:t.tickCount,downvote:t.crossCount,selected:e?"upvote":a?"downvote":null})},[t,d]);let p=async e=>{if(a.selected!==e)try{let t=(await i.A.post("".concat(n.env.NEXT_PUBLIC_URL_BACKEND,"posts/vote/").concat(h),{userId:d,voteType:e})).data;c({upvote:t.tickCount,downvote:t.crossCount,selected:e})}catch(e){console.error("Error al votar:",e)}},g=async()=>{try{await i.A.delete("".concat(n.env.NEXT_PUBLIC_URL_BACKEND,"posts/").concat(h)),x(!1),window.location.reload()}catch(e){console.error("Error al eliminar el post:",e)}};return(0,s.jsxs)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-2xl shadow-md max-w-sm mx-auto overflow-hidden",children:[(0,s.jsxs)("div",{className:"relative aspect-[4/4] w-full",children:[(0,s.jsx)("img",{src:t.image,alt:"Post",className:"w-full h-full object-cover rounded-t-2xl"}),(0,s.jsx)("div",{className:"absolute top-3 right-3 bg-white dark:bg-zinc-800 p-1.5 rounded-full shadow",children:t.auraImpactApplied?(0,s.jsx)(o.F5$,{className:"text-zinc-700 dark:text-white text-lg"}):(0,s.jsx)(o.K4k,{className:"text-zinc-700 dark:text-white text-lg"})}),d===t.author._id&&(0,s.jsx)("button",{onClick:()=>x(!0),className:"cursor-pointer absolute top-3 left-3 bg-rose-600 hover:bg-rose-700 p-1.5 rounded-full text-white shadow",title:"Eliminar post",children:(0,s.jsx)(o.IXo,{className:"text-base"})})]}),(0,s.jsxs)("div",{className:"p-5 space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-zinc-900 dark:text-white truncate",children:t.dedicatedTo.username}),(0,s.jsx)("span",{className:"text-xl font-bold ".concat(t.aura>0?"text-emerald-500":"text-rose-500"),children:t.aura>0?"+".concat(t.aura):t.aura})]}),(0,s.jsx)("p",{className:"text-sm text-zinc-700 dark:text-zinc-300",children:t.description}),(0,s.jsxs)("div",{className:"flex justify-between items-center pt-3 border-t border-zinc-200 dark:border-zinc-700",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("img",{src:t.author.profileImage,alt:"Avatar",className:"w-9 h-9 rounded-full object-cover border"}),(0,s.jsx)("span",{className:"text-sm text-zinc-800 dark:text-zinc-200 font-medium",children:t.author.username})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("button",{onClick:()=>p("upvote"),className:"cursor-pointer p-2 rounded-full border border-emerald-400 transition duration-150 ".concat("upvote"===a.selected?"bg-emerald-100":"hover:bg-emerald-50"),children:(0,s.jsx)(o.YrT,{className:"text-green-600 text-lg"})}),(0,s.jsx)("span",{className:"text-sm text-zinc-800 dark:text-zinc-200",children:a.upvote}),(0,s.jsx)("button",{onClick:()=>p("downvote"),className:"cursor-pointer p-2 rounded-full border border-rose-400 transition duration-150 ".concat("downvote"===a.selected?"bg-rose-100":"hover:bg-rose-50"),children:(0,s.jsx)(o.yGN,{className:"text-red-600 text-lg"})}),(0,s.jsx)("span",{className:"text-sm text-zinc-800 dark:text-zinc-200",children:a.downvote})]})]})]}),m&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"mr-4 ml-4 bg-white dark:bg-zinc-900 p-6 rounded-xl shadow-lg max-w-sm w-full text-center space-y-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-rose-600",children:"\xbfEliminar post?"}),(0,s.jsx)("p",{className:"text-sm text-zinc-700 dark:text-zinc-300",children:"Esta acci\xf3n no se puede deshacer."}),(0,s.jsxs)("div",{className:"flex justify-center gap-4",children:[(0,s.jsx)("button",{onClick:()=>x(!1),className:"cursor-pointer px-4 py-2 rounded-md bg-zinc-200 dark:bg-zinc-700 text-sm hover:bg-zinc-300 dark:hover:bg-zinc-600",children:"Cancelar"}),(0,s.jsx)("button",{onClick:g,className:"cursor-pointer px-4 py-2 rounded-md bg-rose-600 text-white text-sm hover:bg-rose-700",children:"Confirmar"})]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[394,715,405,315,636,593,792],()=>t(19674)),_N_E=e.O()}]);